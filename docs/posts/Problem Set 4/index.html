<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joe Penders">
<meta name="dcterms.date" content="2023-09-30">

<title>Joe Penders - Problem Set 4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/personal_logo.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Joe Penders</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html" rel="" target="">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html" rel="" target="">
 <span class="menu-text">Resume</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#section" id="toc-section" class="nav-link active" data-scroll-target="#section">1.</a></li>
  <li><a href="#section-1" id="toc-section-1" class="nav-link" data-scroll-target="#section-1">2.</a></li>
  <li><a href="#section-2" id="toc-section-2" class="nav-link" data-scroll-target="#section-2">3.</a></li>
  <li><a href="#build-a-logistic-lasso-model-using-cross-validation-on-the-training-data-to-select-the-best-ùû¥.-view-the-coefficients-at-that-chosen-ùû¥-and-see-what-features-are-in-the-model." id="toc-build-a-logistic-lasso-model-using-cross-validation-on-the-training-data-to-select-the-best-ùû¥.-view-the-coefficients-at-that-chosen-ùû¥-and-see-what-features-are-in-the-model." class="nav-link" data-scroll-target="#build-a-logistic-lasso-model-using-cross-validation-on-the-training-data-to-select-the-best-ùû¥.-view-the-coefficients-at-that-chosen-ùû¥-and-see-what-features-are-in-the-model.">4. Build a logistic LASSO model using cross-validation on the training data to select the best ùû¥. View the coefficients at that chosen ùû¥ and see what features are in the model.</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Problem Set 4</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joe Penders </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 30, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section">1.</h2>
<p>The objective of the NVO is to predict a binary outcome: whether a person will respond to a mailing or not. Classification is the right approach to accomplish this task. By utilizing classification, the organization can take advantage of historical data to identify patterns or characteristics that are indicative of a positive response. This will enable the NVO to target individuals who are more likely to respond, increasing the overall response rate.</p>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1">2.</h2>
<p>Once a classifier is built, the National Veterans Organization (NVO) can use it to predict the likelihood of potential donors responding to their mailings. Figuring out which variables contribute to a person being more likely to respond enables the organization to optimize their outreach efforts. If the classifier is accurate, this approach can lead to a higher response rate and a more efficient allocation of resources compared to blanket mailings. Additionally, by relying on data-driven predictions, the NVO can minimize biases or assumptions that might have influenced their previous outreach strategies. Having a more systematic and objective method to identify potential donors could lead to the NVO collecting more donations while also reducing the cost of outreach.</p>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2">3.</h2>
<p>To evaluate the classifiers performance I will look at several measures from the confusion matrix: precision, sensitivity and the F-measure. The precision of the classifier will tell me the proportion of the positive response predictions that are actually true. Sensitivity will indicate how well the classifier can detect positive responses overall. The F-measure is number derived from precision and sensitivity. By focusing on these metrics, NVO can ensure that they‚Äôre both maximizing the number of donation opportunities and ensuring that their outreach efforts are effective.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the data, and view</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>donors <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"donors.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(donors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [95,412 √ó 22] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ age                    : num [1:95412] 60 46 NA 70 78 NA 38 NA NA 65 ...
 $ numberChildren         : num [1:95412] NA 1 NA NA 1 NA 1 NA NA NA ...
 $ incomeRating           : num [1:95412] NA 6 3 1 3 NA 4 2 3 NA ...
 $ wealthRating           : num [1:95412] NA 9 1 4 2 NA 6 9 2 NA ...
 $ mailOrderPurchases     : num [1:95412] 0 16 2 2 60 0 0 1 0 0 ...
 $ totalGivingAmount      : num [1:95412] 240 47 202 109 254 51 107 31 199 28 ...
 $ numberGifts            : num [1:95412] 31 3 27 16 37 4 14 5 11 3 ...
 $ smallestGiftAmount     : num [1:95412] 5 10 2 2 3 10 3 5 10 3 ...
 $ largestGiftAmount      : num [1:95412] 12 25 16 11 15 16 12 11 22 15 ...
 $ averageGiftAmount      : num [1:95412] 7.74 15.67 7.48 6.81 6.86 ...
 $ yearsSinceFirstDonation: num [1:95412] 8 3 7 10 11 3 10 3 9 3 ...
 $ monthsSinceLastDonation: num [1:95412] 14 14 14 14 13 20 22 18 19 22 ...
 $ inHouseDonor           : logi [1:95412] FALSE FALSE FALSE FALSE TRUE FALSE ...
 $ plannedGivingDonor     : logi [1:95412] FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ sweepstakesDonor       : logi [1:95412] FALSE FALSE FALSE FALSE FALSE FALSE ...
 $ P3Donor                : logi [1:95412] FALSE FALSE FALSE FALSE TRUE FALSE ...
 $ state                  : chr [1:95412] "IL" "CA" "NC" "CA" ...
 $ urbanicity             : chr [1:95412] "town" "suburb" "rural" "rural" ...
 $ socioEconomicStatus    : chr [1:95412] "average" "highest" "average" "average" ...
 $ isHomeowner            : logi [1:95412] NA TRUE NA NA TRUE NA ...
 $ gender                 : chr [1:95412] "female" "male" "male" "female" ...
 $ respondedMailing       : logi [1:95412] FALSE FALSE FALSE FALSE FALSE FALSE ...
 - attr(*, "spec")=
  .. cols(
  ..   age = col_double(),
  ..   numberChildren = col_double(),
  ..   incomeRating = col_double(),
  ..   wealthRating = col_double(),
  ..   mailOrderPurchases = col_double(),
  ..   totalGivingAmount = col_double(),
  ..   numberGifts = col_double(),
  ..   smallestGiftAmount = col_double(),
  ..   largestGiftAmount = col_double(),
  ..   averageGiftAmount = col_double(),
  ..   yearsSinceFirstDonation = col_double(),
  ..   monthsSinceLastDonation = col_double(),
  ..   inHouseDonor = col_logical(),
  ..   plannedGivingDonor = col_logical(),
  ..   sweepstakesDonor = col_logical(),
  ..   P3Donor = col_logical(),
  ..   state = col_character(),
  ..   urbanicity = col_character(),
  ..   socioEconomicStatus = col_character(),
  ..   isHomeowner = col_logical(),
  ..   gender = col_character(),
  ..   respondedMailing = col_logical()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(donors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      age        numberChildren   incomeRating    wealthRating  
 Min.   : 1.00   Min.   :1.00    Min.   :1.000   Min.   :0.00   
 1st Qu.:48.00   1st Qu.:1.00    1st Qu.:2.000   1st Qu.:3.00   
 Median :62.00   Median :1.00    Median :4.000   Median :6.00   
 Mean   :61.61   Mean   :1.53    Mean   :3.886   Mean   :5.35   
 3rd Qu.:75.00   3rd Qu.:2.00    3rd Qu.:5.000   3rd Qu.:8.00   
 Max.   :98.00   Max.   :7.00    Max.   :7.000   Max.   :9.00   
 NA's   :23665   NA's   :83026   NA's   :21286   NA's   :44732  
 mailOrderPurchases totalGivingAmount  numberGifts      smallestGiftAmount
 Min.   :  0.000    Min.   :  13.0    Min.   :  1.000   Min.   :   0.000  
 1st Qu.:  0.000    1st Qu.:  40.0    1st Qu.:  3.000   1st Qu.:   3.000  
 Median :  0.000    Median :  78.0    Median :  7.000   Median :   5.000  
 Mean   :  3.321    Mean   : 104.5    Mean   :  9.602   Mean   :   7.934  
 3rd Qu.:  3.000    3rd Qu.: 131.0    3rd Qu.: 13.000   3rd Qu.:  10.000  
 Max.   :241.000    Max.   :9485.0    Max.   :237.000   Max.   :1000.000  
                                                                          
 largestGiftAmount averageGiftAmount  yearsSinceFirstDonation
 Min.   :   5      Min.   :   1.286   Min.   : 0.000         
 1st Qu.:  14      1st Qu.:   8.385   1st Qu.: 2.000         
 Median :  17      Median :  11.636   Median : 5.000         
 Mean   :  20      Mean   :  13.348   Mean   : 5.596         
 3rd Qu.:  23      3rd Qu.:  15.478   3rd Qu.: 9.000         
 Max.   :5000      Max.   :1000.000   Max.   :13.000         
                                                             
 monthsSinceLastDonation inHouseDonor    plannedGivingDonor sweepstakesDonor
 Min.   : 0.00           Mode :logical   Mode :logical      Mode :logical   
 1st Qu.:12.00           FALSE:88709     FALSE:95298        FALSE:93795     
 Median :14.00           TRUE :6703      TRUE :114          TRUE :1617      
 Mean   :14.36                                                              
 3rd Qu.:17.00                                                              
 Max.   :23.00                                                              
                                                                            
  P3Donor           state            urbanicity        socioEconomicStatus
 Mode :logical   Length:95412       Length:95412       Length:95412       
 FALSE:93395     Class :character   Class :character   Class :character   
 TRUE :2017      Mode  :character   Mode  :character   Mode  :character   
                                                                          
                                                                          
                                                                          
                                                                          
 isHomeowner       gender          respondedMailing
 Mode:logical   Length:95412       Mode :logical   
 TRUE:52354     Class :character   FALSE:90569     
 NA's:43058     Mode  :character   TRUE :4843      
                                                   
                                                   
                                                   
                                                   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the number and percentage of NAs for each column</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>na_summary <span class="ot">&lt;-</span> donors <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(column, na_count) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_percentage =</span> (na_count <span class="sc">/</span> <span class="fu">nrow</span>(donors)) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(na_count <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(na_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 √ó 3
  column              na_count na_percentage
  &lt;chr&gt;                  &lt;int&gt;         &lt;dbl&gt;
1 age                    23665         24.8 
2 numberChildren         83026         87.0 
3 incomeRating           21286         22.3 
4 wealthRating           44732         46.9 
5 urbanicity              2316          2.43
6 socioEconomicStatus     2316          2.43
7 isHomeowner            43058         45.1 
8 gender                  4676          4.90</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop number of children</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>donors <span class="ot">&lt;-</span> donors <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>numberChildren) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>(donors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>87% of the data in <code>numberChildren</code> is missing, so I dropped it due to it not being useful as a predictor. Since we have such a large amount of data I have decided to drop every record which has missing values. There is a lot of missing data, but even after omitting every incomplete record we still have 33230 observations to work with.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change categorical types to factor variables</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>donors <span class="ot">&lt;-</span> donors <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(incomeRating, wealthRating, socioEconomicStatus, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                 gender, state, urbanicity, respondedMailing), <span class="at">.funs=</span>factor)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows where respondedMailing or any numeric column is NA</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>donors_num_cleaned <span class="ot">&lt;-</span> donors <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(respondedMailing)) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age, mailOrderPurchases, </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>         totalGivingAmount, numberGifts, smallestGiftAmount, largestGiftAmount, </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>         averageGiftAmount, yearsSinceFirstDonation, monthsSinceLastDonation, </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>         respondedMailing) <span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Histogram Plots</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a transparent theme for better visualization</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">transparentTheme</span>(<span class="at">trans =</span> <span class="fl">0.9</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Histogram plots</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">featurePlot</span>(<span class="at">x =</span> donors_num_cleaned <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>respondedMailing),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> donors_num_cleaned<span class="sc">$</span>respondedMailing,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot =</span> <span class="st">"density"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">scale =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">list</span>(<span class="at">relation=</span><span class="st">'free'</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">list</span>(<span class="at">relation=</span><span class="st">'free'</span>)),</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">adjust =</span> <span class="fl">1.5</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">pch =</span> <span class="st">"|"</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">layout =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">columns =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>caret<span class="sc">::</span><span class="fu">featurePlot</span>(<span class="at">x =</span> donors_num_cleaned <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>respondedMailing),</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> donors_num_cleaned<span class="sc">$</span>respondedMailing,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">plot =</span> <span class="st">"box"</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">scales =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="at">relation=</span><span class="st">'free'</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x =</span> <span class="fu">list</span>(<span class="at">rot=</span><span class="dv">90</span>)),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">layout =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">auto.key =</span> <span class="fu">list</span>(<span class="at">columns =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Association between wealth and income ratings</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(donors<span class="sc">$</span>incomeRating, donors<span class="sc">$</span>wealthRating)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
       0    1    2    3    4    5    6    7    8    9
  1  282  335  310  259  241  258  228  211  150   84
  2  338  558  616  574  597  548  552  441  316  134
  3  158  252  343  363  387  420  459  453  384  238
  4  208  364  461  498  654  806  872  974  931  699
  5  175  284  409  546  711  914 1019 1228 1406 1205
  6   46   77  117  138  206  313  481  568  867 1389
  7   49   58   80   95  138  183  277  526  866 1903</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>vcd<span class="sc">::</span><span class="fu">assocstats</span>(<span class="fu">table</span>(donors<span class="sc">$</span>incomeRating, donors<span class="sc">$</span>wealthRating))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    X^2 df P(&gt; X^2)
Likelihood Ratio 7960.4 54        0
Pearson          8155.4 54        0

Phi-Coefficient   : NA 
Contingency Coeff.: 0.444 
Cramer's V        : 0.202 </code></pre>
</div>
</div>
<p>I suspected there would be a relationship between <code>incomeRating</code> and <code>wealthRating</code>. A Cramer‚Äôs V value of 0.202 indicates that there is a weak to moderate relationship between these two variables. I am going to leave them both in.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Look for correlation between numeric variables</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>donors <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep</span>(is.numeric) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  corrplot<span class="sc">::</span><span class="fu">corrplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see positive correlation between <code>averageGiftAmount</code> with both <code>largestGiftAmount</code> and <code>smallestGiftAmount</code>. There‚Äôs also positive correlation between <code>yearsSinceFirstDonation</code> and <code>numberGifts</code>. These are all medium strength correlations, so for now I will leave them in.</p>
</section>
<section id="build-a-logistic-lasso-model-using-cross-validation-on-the-training-data-to-select-the-best-ùû¥.-view-the-coefficients-at-that-chosen-ùû¥-and-see-what-features-are-in-the-model." class="level2">
<h2 class="anchored" data-anchor-id="build-a-logistic-lasso-model-using-cross-validation-on-the-training-data-to-select-the-best-ùû¥.-view-the-coefficients-at-that-chosen-ùû¥-and-see-what-features-are-in-the-model.">4. Build a logistic LASSO model using cross-validation on the training data to select the best ùû¥. View the coefficients at that chosen ùû¥ and see what features are in the model.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating dummy variables from categorical variables</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>donors <span class="ot">&lt;-</span> <span class="fu">dummy_cols</span>(donors, <span class="at">select_columns =</span> <span class="fu">c</span>(<span class="st">"incomeRating"</span>, <span class="st">"wealthRating"</span>, <span class="st">"socioEconomicStatus"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                                                <span class="st">"gender"</span>, <span class="st">"state"</span>, <span class="st">"urbanicity"</span>),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">remove_selected_columns =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>incomeRating_1, <span class="sc">-</span>wealthRating_0, <span class="sc">-</span>socioEconomicStatus_average, <span class="sc">-</span>gender_joint, <span class="sc">-</span>gender_male,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>state_AA, <span class="sc">-</span>state_AA, <span class="sc">-</span>urbanicity_rural)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaling numerical variables</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>numerical_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'age'</span>, <span class="st">'mailOrderPurchases'</span>, <span class="st">'totalGivingAmount'</span>, </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'numberGifts'</span>, <span class="st">'smallestGiftAmount'</span>, <span class="st">'largestGiftAmount'</span>, <span class="st">'averageGiftAmount'</span>, </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'yearsSinceFirstDonation'</span>, <span class="st">'monthsSinceLastDonation'</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>donors[numerical_vars] <span class="ot">&lt;-</span> <span class="fu">scale</span>(donors[numerical_vars])</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Partition the data.</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1001</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>samp <span class="ot">=</span> <span class="fu">createDataPartition</span>(donors<span class="sc">$</span>respondedMailing, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>training <span class="ot">=</span> donors[samp, ]</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>testing <span class="ot">=</span> donors[<span class="sc">-</span>samp, ]</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(samp)</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">#check for class imbalance</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>training <span class="sc">%&gt;%</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(respondedMailing) <span class="sc">%&gt;%</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">table</span>() <span class="sc">%&gt;%</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>respondedMailing
     FALSE       TRUE 
0.94712406 0.05287594 </code></pre>
</div>
</div>
<p>There is a significant class imbalance, I will use smote to correct it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Smote </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>smote_train <span class="ot">=</span> <span class="fu">smote</span>(respondedMailing <span class="sc">~</span> .,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">data =</span> training)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(smote_train<span class="sc">$</span>respondedMailing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
FALSE  TRUE 
 4920  3690 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate predictors and response</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(smote_train<span class="sc">$</span>respondedMailing)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(smote_train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>respondedMailing))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use cross-validation to find the best lambda</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>cv.lasso <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X, y, <span class="at">family=</span><span class="st">"binomial"</span>, <span class="at">alpha=</span><span class="dv">1</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract best lambda</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>best_lambda <span class="ot">&lt;-</span> cv.lasso<span class="sc">$</span>lambda<span class="fl">.1</span>se</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model using the best lambda</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>LASSO_model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, y, <span class="at">family=</span><span class="st">"binomial"</span>, <span class="at">alpha=</span><span class="dv">1</span>, <span class="at">lambda=</span>best_lambda, <span class="at">maxit =</span> <span class="fl">1e6</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co"># View the coefficients</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(LASSO_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>89 x 1 sparse Matrix of class "dgCMatrix"
                                      s0
(Intercept)                 -0.598546198
age                          0.045580706
mailOrderPurchases           .          
totalGivingAmount            .          
numberGifts                  .          
smallestGiftAmount           .          
largestGiftAmount           -0.230728654
averageGiftAmount           -0.117186971
yearsSinceFirstDonation      .          
monthsSinceLastDonation     -0.092631409
inHouseDonor                -0.012863467
plannedGivingDonor           .          
sweepstakesDonor             .          
P3Donor                      .          
isHomeowner                  .          
incomeRating_2               .          
incomeRating_3               .          
incomeRating_4              -0.279123095
incomeRating_5              -0.251042345
incomeRating_6               0.361244872
incomeRating_7              -0.135812460
wealthRating_1               .          
wealthRating_2               .          
wealthRating_3               0.242357201
wealthRating_4              -0.133213966
wealthRating_5              -0.148504342
wealthRating_6               0.095310582
wealthRating_7               0.097658191
wealthRating_8               0.319708802
wealthRating_9              -0.219063254
socioEconomicStatus_highest  .          
socioEconomicStatus_lowest  -0.423174836
gender_female               -0.445589926
state_AE                     0.575545901
state_AK                     .          
state_AL                     1.841101729
state_AP                     .          
state_AR                     .          
state_AZ                     .          
state_CA                     0.321249192
state_CO                     .          
state_CT                     .          
state_DE                     .          
state_FL                     .          
state_GA                     1.221292620
state_HI                     .          
state_IA                     .          
state_ID                     0.388287462
state_IL                     .          
state_IN                    -0.003340735
state_KS                     .          
state_KY                     .          
state_LA                     .          
state_MA                     .          
state_MD                     .          
state_ME                     .          
state_MI                     .          
state_MN                     1.583330439
state_MO                     .          
state_MS                    -0.228310896
state_MT                     .          
state_NC                     .          
state_ND                     .          
state_NE                    -0.140898223
state_NH                     .          
state_NJ                     .          
state_NM                     .          
state_NV                     .          
state_NY                     .          
state_OH                     .          
state_OK                     2.168223127
state_OR                     .          
state_PA                     .          
state_RI                     .          
state_SC                     0.038535568
state_SD                     0.892871747
state_TN                     .          
state_TX                     .          
state_UT                     .          
state_VA                     .          
state_VT                     .          
state_WA                     .          
state_WI                    -0.256755139
state_WV                     0.403782677
state_WY                     0.863087203
urbanicity_city             -0.086388277
urbanicity_suburb            0.421327308
urbanicity_town              .          
urbanicity_urban             .          </code></pre>
</div>
</div>
<p>At the chosen ùû¥ = .0091, the features in our model are: <code>age</code>, <code>largestGiftAmount</code>, <code>averageGiftAmount</code>, <code>monthsSinceLastDonation</code>, <code>inHouseDonor</code>, <code>incomeRating_4</code>, <code>incomeRating_5</code>, <code>incomeRating_6</code>, <code>incomeRating_7</code>, <code>wealthRating_3</code>, <code>wealthRating_4</code>, <code>wealthRating_5</code>, <code>wealthRating_6</code>, <code>wealthRating_7</code>, <code>wealthRating_8</code>, <code>wealthRating_9</code>, <code>socioEconomicStatus_lowest,</code> <code>gender_female</code>, <code>state_AE</code>, <code>state_AL</code>, <code>state_CA</code>, <code>state_GA</code>, <code>state_ID</code>, <code>state_IN</code>, <code>state_MN</code>, <code>state_MS</code>, <code>state_NE</code>, <code>state_OK</code>, <code>state_SC</code>, <code>state_SD</code>, <code>state_WI</code>, <code>state_WV</code>, <code>state_WY</code>, <code>urbanicity_city</code>, <code>urbanicity_suburb</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build a decision tree model. Crossvalidate and tune over values of cp.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1001</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>ctrl <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"repeatedcv"</span>, <span class="at">number =</span> <span class="dv">5</span>, <span class="at">repeats =</span> <span class="dv">30</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>tree_model <span class="ot">=</span> caret<span class="sc">::</span><span class="fu">train</span>(respondedMailing <span class="sc">~</span> ., </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> smote_train, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">"rpart"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">metric =</span> <span class="st">"Kappa"</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">trControl =</span> ctrl,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">cp =</span> <span class="fu">seq</span>(<span class="fl">0.0</span>, <span class="fl">0.1</span>, <span class="fl">0.005</span>)))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>bestCp <span class="ot">&lt;-</span> tree_model<span class="sc">$</span>bestTune<span class="sc">$</span>cp</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the cp</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tree_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the regression tree model using the best cp value</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>tree_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(respondedMailing <span class="sc">~</span> ., <span class="at">data =</span> smote_train, <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> bestCp))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>rpart.plot<span class="sc">::</span><span class="fu">rpart.plot</span>(tree_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The decision tree uses the features: <code>gender_female</code>, <code>urbanicity_suburb</code>, <code>state_MN</code>, <code>state_OK</code>, <code>state_CA</code>, <code>state_GA</code>, <code>state_AL</code>, <code>wealthRating_7</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>test_predictors <span class="ot">=</span> <span class="fu">as.matrix</span>(testing <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>respondedMailing))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Performance of LASSO</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>LASSO_test_class <span class="ot">=</span> <span class="fu">predict</span>(LASSO_model, <span class="at">newx =</span> test_predictors, <span class="at">s =</span> best_lambda, <span class="at">type=</span><span class="st">"class"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>LASSO_test_prob <span class="ot">=</span> <span class="fu">predict</span>(LASSO_model, <span class="at">newx =</span> test_predictors, <span class="at">s =</span> best_lambda, <span class="at">type=</span><span class="st">"response"</span>)[,<span class="dv">1</span>]</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Performance of tree</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>tree_test_class <span class="ot">=</span> <span class="fu">predict</span>(tree_model, <span class="at">newdata =</span> <span class="fu">as.data.frame</span>(test_predictors), <span class="at">type=</span><span class="st">"class"</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>tree_test_prob <span class="ot">=</span> <span class="fu">predict</span>(tree_model, <span class="at">newdata =</span> <span class="fu">as.data.frame</span>(test_predictors), <span class="at">type=</span><span class="st">"prob"</span>)[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion Matrices</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>response_vector <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(testing<span class="sc">$</span>respondedMailing)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>LASSO_cm <span class="ot">=</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(LASSO_test_class), <span class="fu">factor</span>(response_vector), <span class="at">positive =</span> <span class="st">"TRUE"</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>tree_cm <span class="ot">=</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(tree_test_class), <span class="fu">factor</span>(response_vector), <span class="at">positive =</span> <span class="st">"TRUE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>LASSO_cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction FALSE TRUE
     FALSE  7985  437
     TRUE   1456   90
                                          
               Accuracy : 0.8101          
                 95% CI : (0.8023, 0.8178)
    No Information Rate : 0.9471          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.0087          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.170778        
            Specificity : 0.845779        
         Pos Pred Value : 0.058215        
         Neg Pred Value : 0.948112        
             Prevalence : 0.052869        
         Detection Rate : 0.009029        
   Detection Prevalence : 0.155096        
      Balanced Accuracy : 0.508279        
                                          
       'Positive' Class : TRUE            
                                          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>tree_cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction FALSE TRUE
     FALSE  9376  520
     TRUE     65    7
                                          
               Accuracy : 0.9413          
                 95% CI : (0.9365, 0.9458)
    No Information Rate : 0.9471          
    P-Value [Acc &gt; NIR] : 0.9951          
                                          
                  Kappa : 0.0108          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.0132827       
            Specificity : 0.9931151       
         Pos Pred Value : 0.0972222       
         Neg Pred Value : 0.9474535       
             Prevalence : 0.0528692       
         Detection Rate : 0.0007022       
   Detection Prevalence : 0.0072231       
      Balanced Accuracy : 0.5031989       
                                          
       'Positive' Class : TRUE            
                                          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>tree_roc <span class="ot">=</span> <span class="fu">roc</span>(testing<span class="sc">$</span>respondedMailing <span class="sc">~</span> tree_test_prob,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">plot=</span><span class="cn">TRUE</span>, <span class="at">print.auc=</span><span class="cn">TRUE</span>, <span class="at">print.auc.y=</span><span class="fl">0.3</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">legacy.axes=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>